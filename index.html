<!DOCTYPE html>
<html lang="he">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title> 砖驻转 砖专</title>

    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-storage-compat.js"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Varela+Round&family=Caveat&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Varela Round", sans-serif;
        background: repeating-linear-gradient(
          #fdfbfb,
          #fdfbfb 28px,
          #ebedee 29px,
          #ebedee 30px
        );
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        direction: rtl;
      }
      header {
        width: 100%;
        background: linear-gradient(to right, #6a11cb, #2575fc);
        padding: 30px 0 20px;
        text-align: center;
        color: white;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        position: relative;
      }
      header h1 {
        margin: 0;
        font-size: 2.5rem;
        font-family: "Caveat", cursive;
        letter-spacing: 1px;
      }
      .intro-text {
        margin-top: 10px;
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
        max-width: 800px;
        text-align: center;
        padding: 20px;
        background: #ffffffcc;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        line-height: 1.8;
      }
      .date-box {
        position: absolute;
        top: 10px;
        left: 20px;
        background: #ffffffaa;
        padding: 8px 16px;
        border-radius: 12px;
        font-size: 1rem;
        color: #333;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .tabs {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        background: #ffffffcc;
        padding: 10px;
        margin-top: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .tab-button {
        background: #fff;
        border: 2px solid #6a11cb;
        color: #6a11cb;
        margin: 5px;
        padding: 10px 20px;
        border-radius: 30px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
      }
      .tab-button:hover,
      .tab-button.active {
        background: #6a11cb;
        color: white;
      }
      .tab-button.shir-button {
        background: #ff69b4;
        color: white;
        border: 2px solid #ff69b4;
        font-weight: bold;
        font-size: 1.1rem;
        box-shadow: 0 4px 10px rgba(255, 105, 180, 0.5);
      }
      .tab-content {
        display: none;
        width: 90%;
        max-width: 900px;
        background: #ffffffee;
        margin-top: 20px;
        padding: 25px;
        border-radius: 16px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      }
      .tab-content.active {
        display: block;
      }
      form textarea,
      form input[type="file"] {
        width: 100%;
        margin: 10px 0;
        padding: 14px;
        font-size: 1rem;
        border: 1px solid #ddd;
        border-radius: 12px;
        background: #fafafa;
      }
      .form-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 10px;
      }
      .submit-button,
      .clear-file-button {
        min-width: 120px;
        padding: 10px 20px;
        font-size: 1rem;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: background 0.3s;
      }
      .submit-button {
        background: #28a745;
        color: white;
      }
      .submit-button:hover {
        background: #218838;
      }
      .clear-file-button {
        background: #007bff;
        color: white;
      }
      .clear-file-button:hover {
        background: #0069d9;
      }
      .post {
        background: #fff8b0;
        padding: 20px;
        margin: 20px 0;
        border-radius: 16px;
        box-shadow: 2px 4px 10px rgba(0, 0, 0, 0.15);
        position: relative;
        transform: rotate(-1deg);
        animation: fadeInSlide 0.5s ease;
      }
      .post img,
      .post video,
      .post audio {
        max-width: 100%;
        margin-top: 10px;
        border-radius: 10px;
      }
      .post .timestamp {
        font-size: 0.8rem;
        color: #777;
        margin-top: 10px;
        text-align: left;
      }
      .delete-post-button {
        position: absolute;
        top: 10px;
        left: 10px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 50%;
        width: 26px;
        height: 26px;
        font-size: 1rem;
        cursor: pointer;
      }
      @keyframes fadeInSlide {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>

  <body>
    <header>
      <h1>砖专  砖 -  住注 砖驻转</h1>
      <div class="date-box" id="dateBox"></div>
      <p class="intro-text">
        转专  爪专  注专 砖专 砖,  砖 转 转 专拽 
        转 .   转 住驻专   注专 注, 转 专转 ,
        转 转  砖转祝 转 住注 驻 砖. 
      </p>
    </header>

    <div class="tabs">
      <button class="tab-button" data-tab="mom"></button>
      <button class="tab-button" data-tab="nati"></button>
      <button class="tab-button" data-tab="nir">专</button>
      <button class="tab-button" data-tab="gil"></button>
      <button class="tab-button shir-button active" data-tab="shir">砖专</button>
      <button class="tab-button" data-tab="aviv"></button>
      <button class="tab-button" data-tab="itamar">转专</button>
      <button class="tab-button" data-tab="neta">注</button>
      <button class="tab-button" data-tab="max">拽住</button>
    </div>

    <div id="mom" class="tab-content"></div>
    <div id="nati" class="tab-content"></div>
    <div id="nir" class="tab-content"></div>
    <div id="gil" class="tab-content"></div>
    <div id="shir" class="tab-content active"></div>
    <div id="aviv" class="tab-content"></div>
    <div id="itamar" class="tab-content"></div>
    <div id="neta" class="tab-content"></div>
    <div id="max" class="tab-content"></div>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyDjWYi54AFX0LBhu2czTUmGclJXJ-ArOw0",
        authDomain: "noiman-family.firebaseapp.com",
        projectId: "noiman-family",
        storageBucket: "noiman-family.appspot.com",
        messagingSenderId: "158896938051",
        appId: "1:158896938051:web:744ad75f69936546c848f6",
        databaseURL:
          "https://noiman-family-default-rtdb.europe-west1.firebasedatabase.app/",
      };
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();
      const storage = firebase.storage();

      const tabs = document.querySelectorAll(".tab-button");
      const contents = document.querySelectorAll(".tab-content");

      const familyColors = {
        mom: "#ffb6c1",
        nati: "#add8e6",
        nir: "#ffcc99",
        gil: "#90ee90",
        shir: "#dda0dd",
        aviv: "#87ceeb",
        itamar: "#40e0d0",
        neta: "#dda0dd",
        max: "#a9a9a9",
      };

      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          tabs.forEach((t) => t.classList.remove("active"));
          contents.forEach((c) => c.classList.remove("active"));
          tab.classList.add("active");
          document.getElementById(tab.dataset.tab).classList.add("active");
        });
      });

      contents.forEach((content) => {
        const tabId = content.id;
        const form = document.createElement("form");
        const textarea = document.createElement("textarea");
        textarea.placeholder = "转 注...";
        textarea.required = true;

        const fileInput = document.createElement("input");
        fileInput.type = "file";
        fileInput.accept = "image/*,video/*";

        const formButtons = document.createElement("div");
        formButtons.className = "form-buttons";

        const clearFileButton = document.createElement("button");
        clearFileButton.type = "button";
        clearFileButton.className = "clear-file-button";
        clearFileButton.textContent = "拽 拽抓";
        clearFileButton.addEventListener("click", (e) => {
          e.preventDefault();
          fileInput.value = "";
        });

        const submitButton = document.createElement("button");
        submitButton.type = "submit";
        submitButton.className = "submit-button";
        submitButton.textContent = "砖";

        formButtons.appendChild(clearFileButton);
        formButtons.appendChild(submitButton);

        form.appendChild(textarea);
        form.appendChild(fileInput);
        form.appendChild(formButtons);
        content.appendChild(form);

        const postsDiv = document.createElement("div");
        postsDiv.className = "posts";
        content.appendChild(postsDiv);

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          const text = textarea.value.trim();
          const file = fileInput.files[0];
          if (!text && !file) return;

          let fileData = "";
          let fileType = "";

          if (file) {
            const reader = new FileReader();
            reader.onloadend = async () => {
              fileData = reader.result; // base64 string with data:image/... prefix
              fileType = file.type;

              const timestamp = new Date().toISOString();

              await database.ref(`posts/${tabId}`).push({
                text,
                file: fileData,
                fileType,
                timestamp,
                comments: [],
              });

              textarea.value = "";
              fileInput.value = "";
            };
            reader.readAsDataURL(file);
          } else {
            const timestamp = new Date().toISOString();
            await database.ref(`posts/${tabId}`).push({
              text,
              file: "",
              fileType: "",
              timestamp,
              comments: [],
            });

            textarea.value = "";
            fileInput.value = "";
          }
        });

        database.ref(`posts/${tabId}`).on("value", (snapshot) => {
          postsDiv.innerHTML = "";
          snapshot.forEach((child) => {
            const data = child.val();
            const post = document.createElement("div");
            post.className = "post";
            post.style.background = familyColors[tabId] || "#fff8b0";

            const deleteBtn = document.createElement("button");
            deleteBtn.textContent = "";
            deleteBtn.className = "delete-post-button";
            deleteBtn.addEventListener("click", async () => {
              if (confirm("拽 转 驻住 ?")) {
                await database.ref(`posts/${tabId}/${child.key}`).remove();
              }
            });
            post.appendChild(deleteBtn);

            const p = document.createElement("p");
            p.textContent = data.text;
            post.appendChild(p);

            if (data.file) {
              if (data.fileType.startsWith("image/")) {
                const img = document.createElement("img");
                img.src = data.file;
                post.appendChild(img);
              } else if (data.fileType.startsWith("video/")) {
                const vid = document.createElement("video");
                vid.src = data.file;
                vid.controls = true;
                post.appendChild(vid);
              }
            }

            const time = document.createElement("div");
            time.className = "timestamp";
            time.textContent = new Date(data.timestamp).toLocaleString("he-IL");
            post.appendChild(time);

            // 转转
            const commentBtn = document.createElement("button");
            commentBtn.className = "clear-file-button";
            commentBtn.style.marginTop = "10px";
            commentBtn.textContent = " ";
            post.appendChild(commentBtn);

            const commentsDiv = document.createElement("div");
            commentsDiv.style.marginTop = "10px";
            post.appendChild(commentsDiv);

            if (data.comments) {
              data.comments.forEach((cmt, idx) => {
                const comment = document.createElement("div");
                comment.style.marginTop = "5px";
                comment.innerHTML = `<strong>${cmt.name}:</strong> ${
                  cmt.text || ""
                } わ ${cmt.likes || 0}`;

                const likeBtn = document.createElement("button");
                likeBtn.textContent = "わ";
                likeBtn.style.marginRight = "10px";
                likeBtn.addEventListener("click", async () => {
                  const updatedLikes = (cmt.likes || 0) + 1;
                  data.comments[idx].likes = updatedLikes;
                  await database
                    .ref(`posts/${tabId}/${child.key}/comments`)
                    .set(data.comments);
                });
                comment.appendChild(likeBtn);
                commentsDiv.appendChild(comment);
              });
            }

            commentBtn.addEventListener("click", async () => {
              const name = prompt(" 砖?");
              if (!name) return;
              const commentText = prompt("转 转:");
              if (!commentText) return;

              data.comments = data.comments || [];
              data.comments.push({ name, text: commentText, likes: 0 });
              await database
                .ref(`posts/${tabId}/${child.key}/comments`)
                .set(data.comments);
            });

            postsDiv.prepend(post);
          });
        });
      });

      // 转专 
      const dateBox = document.getElementById("dateBox");
      const today = new Date();
      dateBox.textContent = today.toLocaleDateString("he-IL", {
        day: "numeric",
        month: "long",
        year: "numeric",
      });
    </script>
  </body>
</html>
